<display id="gbrowse_bigwig" version="1.0.0" name="display at EupathDB">

    <!-- Load links from mapping file: one line to one link.  In our case, only one line will match the filter -->
    <dynamic_links from_file="tool-data/shared/gbrowse/gbrowse_build_sites.txt" skip_startswith="#" id="0" name="1">
      
      <!-- the format of the URL is: http://fungidb.org/cgi-bin/gbrowse/fungidb?name=GG663363;eurl=BIGWIG_FILE_URL -->

      <!-- Define parameters by column from file, allow splitting on dbkeys and seq ids -->
      <dynamic_param name="site_name" value="0"/>
      <dynamic_param name="site_dbkeys" value="1" split="True" separator="," />
      <dynamic_param name="site_seq_ids" value="2" split="True" separator="," />
      
      <!-- Filter this dataset's dbkeys to one found in the mapping file (I think!)-->
      <!-- I don't really understand how the filtering works.  The only basis we have for choosing -->
      <!-- a row, it seems, is if this dataset has a dbkey that matches the list in the row -->
      <filter>${dataset.dbkey in $site_dbkeys}</filter>

      <url>http://${site_name}/cgi-bin/gbrowse/${site_name}?name=${site_seq_id};eurl=${bigwig_file.qp}</url>
      <param type="data" name="bigwig_file" url="galaxy_${DATASET_HASH}.bw" />
      <param type="template" name="site_seq_id" strip="True" >
	$site_seq_ids[ $site_dbkeys.index( $bigwig_file.dbkey ) ]
      </param>
    </dynamic_links>
</display>
